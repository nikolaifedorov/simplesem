#!/usr/bin/env ruby
#= Overview
#
# Interpreter for the SIMPLESEM language
#
#= Usage
#
# simplesem [-t|-v] filename
# 
# Options:
#   -h    Print this message
#   -t    Print Data array on exit
#   -v    Print Data array with change history on exit. Supersedes -t 
#         if it is also specified.
#

require 'rdoc/usage'
require 'getoptlong'

# The gem packager will properly add the lib dir to LOAD_PATH when
# executing the gem but load path manipulation is needed during development
unless $LOAD_PATH.include?(File.expand_path('../../lib', __FILE__))
  $LOAD_PATH.unshift(File.expand_path('../../lib', __FILE__))
end

require 'simplesem'   # must execute after manipulating the load path

opts = GetoptLong.new(
  [ '-h', '--help', GetoptLong::NO_ARGUMENT ],
  [ '-t', GetoptLong::NO_ARGUMENT ],
  [ '-v', GetoptLong::NO_ARGUMENT ]
)

verbosity = 0   # by default do not print what is in Data

opts.each do |opt, arg|
  case opt
  when '-h'
    RDoc::usage
  when '-t'
    verbosity = 1
  when '-v'
    verbosity = 2
  end
end

if ARGV.length != 1
  puts "Missing filename argument (try --help)"
  exit 0
end

ssp = SimpleSem::Program.new(ARGV.shift)
ssp.run

case verbosity
when 1
  puts "\nDATA: \n" + ssp.inspect_data
when 2
  puts "\nDATA: \n" + ssp.inspect_data_with_history
end
